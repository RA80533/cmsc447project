<!-- 

File Name: map.html

Description: This file contains code to display and make
appropriate computations for team Purple Parrot's version
of the Map Project for Professor Russ Cain's Spring 2018 
CMSC447 course.

References: http://leafletjs.com/examples/choropleth/

-->

<!DOCTYPE html>
<html>
  <head>
    <title>CMSC447 Map Project</title>
    <h1>
    <p style= "font-family:arial">Map Project CMSC447</p>
    </h1><br>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      body {
        text-align: left;
      }
      .container { 
          width: 100%;
          height: 1000px;
          overflow: auto;
          display: block;
          position: relative;
      }
    
      .main_map{
        height: 70%;
        width: 48%;
        display: inline-block;
 
       }
      .zip_list {
        height: 35%;
        width: 40%; 
        display: inline-block;
        
      }
      .current_zip{
        height: 35%;
        width: 40%; 
        display: inline-block;
      }
      .zip_frame{
        height: 70%;
        width: 40%;
        display: inline-block;
        position: relative;
        overflow: hidden;
      }
    .modal {

        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 137px; /* Location of the box */
        left: 0;
        top: 0;
        width: 48%; /* Full width */
        height: 73%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgb(0,0,0,0.4); /* Black w/ opacity */
    }
    .modal-content {
    
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 66%;
    }
    .divider{
        width:98px;
        height:auto;
        display:inline-block;
    }
    .modal-yes{
    }
    .modal-no{
    }

  </style>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>
 
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
  integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
  crossorigin=""></script>  

  <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

  </head>

  <body>
  
  <button type="button" onclick="resetMapZoom()">Reset Map Zoom</button>
  <div class="divider"></div>
  <button type="button" onclick="clearModal()">Reset Zip Data</button>
  <div class="divider"></div>
  <input id="userzip" type="textbox" value="">
  <input id="submit" type="button" value="Search for Zip Code">  

  <div class="container">

    <div id="zip_modal" class="modal">

      <div class="modal-content">
        <p>Information about this zip code is displayed to the right of the map.<br>
           Would you like to add this zip code to a list, to compare it to other zip codes?</p><br>
           <button type="button" onclick="addtoList()">Yes</button>
           <button type="button" onclick="hideModal()">No</button>
      </div>

    </div>

    <div id="clear_modal" class="modal">

      <div class="modal-content">
        <p>Clear all zip code data?</p><br>
           <button type="button" onclick="clearAllZips()">Yes</button>
           <button type="button" onclick="hideModal()">No</button>
      </div>

    </div>

    <div id="clear_modal_none" class="modal">

      <div class="modal-content">
        <p>There is no data to clear.</p><br>
           <button type="button" onclick="hideModal()">Ok</button>
      </div>

    </div>

    <div class="main_map" id="main_map"></div>

    <div class="zip_frame" id="zip_frame">
      <div class="current_zip" id="current_zip"></div><br>
      <div class="zip_list" id="zip_list"></div><br>
      <button type="button" id="compare" style="display: none;">Compare Zip Codes</button>      
    </div>

  </div>

  <script>

  var main_map;
  var state_json;
  var zip_json;
  var current_zoom = 4;

  function initMap(){

    main_map = L.map('main_map').setView([38, -95], 4);

    // Add a tile to the main map.
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: 'pk.eyJ1IjoiZGN1b2NjaTEiLCJhIjoiY2pmdW4zcnV2M2dtYjJxbWRwcnlydmQxNiJ9.Ja1qbYFizBsPj_lSiPYAjQ'

    }).addTo(main_map);

    addStateLayer();

    // Check to see if a shift in the visible
    // JSON layer is required.
    main_map.on('zoomend', function(){

      checkLayers();

    });

  } // END initMap()

  function addStateLayer(){
 
     // Query the json data.
     $(document).ready(function () {

       $.getJSON("https://swe.umbc.edu/~dcuocci1/cmsc447project/frontEnd/us-states.json", function(data) { addDataToMap(data, main_map); });   

     });
    
      // Note: The combination of addDataToMap, getStateColor,
      // and stateStyle functions work together to get a unique
      // color for states in a given range, and add it to each
      // state. States are represented as features, and the 
      // color computes using feature.id.
      function addDataToMap(data, map) {

          state_json = L.geoJson(data, {style: stateStyle, onEachFeature:onEachFeature});
          state_json.addTo(map);

      }

      function getStateColor(d) {
          return d > 40 ? '#800026' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                           '#FFEDA0';
      }

      function stateStyle(feature) {
     
        return {

          fillColor: getStateColor(feature.id),
          weight: 2,
          opacity: 1,
          color: 'white',
          //dashArray: '3',
          fillOpacity: 0.7

        };
      }

    // Add listeners to json layer to mouse in
    // and out of them, highlighting their borders.
    function onEachFeature(feature, layer) {

      layer.on({

          mouseover: highlightFeature,
          mouseout: resetHighlightState,
          click: zipZoom

      });
    }

  } // END addStateLayer()

  function addZipLayer(){
 
     // Query the json data.
     $(document).ready(function () {

       $.getJSON("https://github.com/jatmdm/cmsc447project/tree/master/frontEnd/zips.php?zips=us-country-zips", function(data) { addDataToMap(data, main_map); });   

     });
    
      // Note: The combination of addDataToMap, getZipColor,
      // and zipStyle functions work together to get a unique
      // color for states in a given range, and add it to each
      // state. States are represented as features, and the 
      // color computes using feature.id.
      function addDataToMap(data, map) {

          zip_json = L.geoJson(data, {style: zipStyle, onEachFeature:onEachFeature});
          zip_json.addTo(map);

      }

      function getZipColor(d) {

          return d > 99950 ? '#800026' :
                 d > 99900  ? '#BD0026' :
                 d > 99800  ? '#E31A1C' :
                 d > 99700  ? '#FC4E2A' :
                 d > 99600   ? '#FD8D3C' :
                 d > 99500   ? '#FEB24C' :
                 d > 99400   ? '#FED976' :
                 d > 99300  ? '#BD0026' :
                 d > 99200  ? '#E31A1C' :
                 d > 99100  ? '#FC4E2A' :
                 d > 99000   ? '#FD8D3C' :
                 d > 98900   ? '#FEB24C' :
                 d > 98800   ? '#FED976' :
                 d > 98700  ? '#BD0026' :
                 d > 98600  ? '#E31A1C' :
                 d > 98500  ? '#FC4E2A' :
                 d > 98400   ? '#FD8D3C' :
                 d > 98300   ? '#FEB24C' :
                 d > 98200   ? '#FED976' :
                 d > 98100  ? '#BD0026' :
                 d > 98000  ? '#E31A1C' :
                 d > 97900  ? '#FC4E2A' :
                 d > 97800   ? '#FD8D3C' :
                 d > 97700   ? '#FEB24C' :
                 d > 97600   ? '#FED976' :
                 d > 97500  ? '#BD0026' :
                 d > 97400  ? '#E31A1C' :
                 d > 97300  ? '#FC4E2A' :
                 d > 97200   ? '#FD8D3C' :
                 d > 97100   ? '#FEB24C' :
                 d > 97000   ? '#FED976' :
                 d > 96900  ? '#BD0026' :
                 d > 96800 ? '#E31A1C' :
                 d > 96700  ? '#FC4E2A' :
                 d > 96600   ? '#FD8D3C' :
                 d > 96500   ? '#FEB24C' :
                 d > 96400   ? '#FED976' :
                 d > 96300  ? '#BD0026' :
                 d > 96200  ? '#E31A1C' :
                 d > 96100  ? '#FC4E2A' :
                 d > 96000   ? '#FD8D3C' :
                 d > 95900   ? '#FEB24C' :
                 d > 95800   ? '#FED976' :
                 d > 95700  ? '#BD0026' :
                 d > 95600  ? '#E31A1C' :
                 d > 95500  ? '#FC4E2A' :
                 d > 95400   ? '#FD8D3C' :
                 d > 95300   ? '#FEB24C' :
                 d > 95200   ? '#FED976' :
                 d > 95100   ? '#FEB24C' :
                 d > 95000   ? '#FED976' :
                 d > 94900  ? '#BD0026' :
                 d > 94800  ? '#E31A1C' :
                 d > 94700  ? '#FC4E2A' :
                 d > 94600   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :
                 d > 35  ? '#BD0026' :
                 d > 30  ? '#E31A1C' :
                 d > 20  ? '#FC4E2A' :
                 d > 15   ? '#FD8D3C' :
                 d > 10   ? '#FEB24C' :
                 d > 5   ? '#FED976' :




                           '#FFEDA0';
      }

      function zipStyle(feature) {
     
        return {

          fillColor: getZipColor(feature.id),
          weight: 2,
          opacity: 1,
          color: 'white',
          //dashArray: '3',
          fillOpacity: 0.7

        };
      }

      // Add listeners to json layer to mouse in
      // and out of them, highlighting their borders.
      function onEachFeature(feature, layer) {

        layer.on({

          mouseover: highlightFeature,
          mouseout: resetHighlightZip,
          // click: zipZoom

        });
     }

  } 

  // Highlight the border. Used for mouseover listeners.
  function highlightFeature(e) {
    
    var layer = e.target;

    layer.setStyle({

        weight: 3.5,
        color: '#000000',
        dashArray: '',
        fillOpacity: 0.7

    });

    // Per the Leaflet documentation, bringToFront() does
    // not work very well in these browsers.
    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {

        layer.bringToFront();

    }
  }

  // Stop highlighting the moused over state layer.
  function resetHighlightState(e) {

    state_json.resetStyle(e.target);

  } 

  // Stop highlighting the moused over zip layer.
  function resetHighlightZip(e) {

    zip_json.resetStyle(e.target);

  }

  // Zoom to a more appropriate scale to enable zip selection.
  function zipZoom(e){

      if (current_zoom < 9){

        current_zoom += 5;
        main_map.setView([e.latlng.lat, e.latlng.lng], current_zoom);
        main_map.removeLayer(state_json);
        addZipLayer();

      }

      else if (current_zoom >= 9){

        current_zoom += 1;
        main_map.setView([e.latlng.lat, e.latlng.lng], current_zoom);

      }

  }

  // Zoom the map back out.
  function resetMapZoom(){

    main_map.setView([38, -95], 4);
    addStateLayer();
    current_zoom = 4;

  }

  // Check to see if the layers need a swap.
  function checkLayers(){

    var map_scale = main_map.getZoom();
    current_zoom = map_scale;

    if(map_scale < 9){

      main_map.removeLayer(zip_json);
      addStateLayer();      

    }

    else if(map_scale >= 9){

      main_map.removeLayer(state_json);
      addZipLayer();
      

    }

  }

  </script>


  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlbhFBE6Pe-UpthT8KqrlXTIt91_9qgPc&callback=initMap">
  </script>


  
  </body>
</html>
