<!DOCTYPE html>
<html>
  <head>
    <title>CMSC447 Map Project</title>
    <h1>
    <p style= "font-family:arial">Map Project CMSC447</p>
    </h1><br>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>


      body {

        text-align: left;
      }

      .container { 

          width: 100%;
          height: 1000px;
          overflow: auto;
          display: block;
          position: relative;

      }
    
      .dual_map {

        height: 60%;
        width: 49%;
        display: inline-block;     

      }

      .main_map{

        height: 70%;
        width: 70%;
        display: inline-block;
 
       }

      .alaska_map {
        height: 25%;
        width: 24%; 
        display: inline-block;
        
      }

      .hawaii_map{
        height: 25%;
        width: 24%; 
        display: inline-block;

      }

    </style>
  </head>
  <body>

  <button type="button" onclick="resetMap()">Reset Map Zoom</button>

  <div class="container">
    <div class="main_map" id="main_map"></div>
  <!--  <div class="dual_map">
        <div class="alaska_map" id="alaska_map"></div><br>
        <div class="hawaii_map" id="hawaii_map"></div> -->
    </div>
  </div>

  <script>

  var main_map;
  var marker_arr = new Array();
  var marker_index = 0;

  function initMap() {

      main_map = null;

      var myLatlng = {lat: 38, lng: -95};

      main_map = new google.maps.Map(document.getElementById('main_map'), {
        zoom: 4.9,
        center: myLatlng
       });

      /* Listen for mouse clicks, zoom there. */
      main_map.addListener('click', function(e) {
      mapZoom(e.latLng, main_map);
      });

      main_map.data.loadGeoJson('https://raw.githubusercontent.com/OpenDataDE/State-zip-code-GeoJSON/master/ak_alaska_zip_codes_geo.min.json');
      main_map.data.setStyle({

            cursor: 'default'
            
       });
      main_map.data.addListener('click', function(e) {
      zipZoom(e.latLng, main_map);
      });
      
 
      /* Create the zip code layer.
      var layer = new google.maps.FusionTablesLayer({
        suppressInfoWindows: true,
        query: {
        select: 'geometry',
        from: '1kNjIhqt7q-OuWMXf-U4PWLleNndKnrlWtd1aE6Ki',
        }
      });
      layer.setMap(main_map); 
      layer.addListener('click', function(e) {
        mapZoom(e.latLng, main_map);
      }); */
      
      main_map.data.loadGeoJson('https://raw.githubusercontent.com/qmmr/mongodb/master/zips.json');
      main_map.data.setStyle({
        fillColor: 'green',
        strokeWeight: 1
      });

    /*    myLatlng = {lat: 64.0000, lng: -150.0000};
        var alaska_map = new google.maps.Map(document.getElementById('alaska_map'), {
          zoom: 2.4,
          center: myLatlng
        });

        myLatlng = {lat: 20.3114, lng: -157.7964};
        var hawaii_map = new google.maps.Map(document.getElementById('hawaii_map'), {
          zoom: 5,
          center: myLatlng
        }); */

      /*  alaska_map.addListener('click', function(e) {
        mapZoom(e.latLng, alaska_map);
        });

        hawaii_map.addListener('click', function(e) {
        mapZoom(e.latLng, hawaii_map);
        }); */

      /*  var marker = new google.maps.Marker({
          position: myLatlng,
          map: map,
          title: 'Click to zoom'
        });

        map.addListener('center_changed', function() {
          // 3 seconds after the center of the map has changed, pan back to the
          // marker.
          window.setTimeout(function() {
            map.panTo(marker.getPosition());
          }, 3000);
        }); 

        marker.addListener('click', function() {
          map.setZoom(8);
          map.setCenter(marker.getPosition());
        }); */
      }

      function mapZoom(latLng, map) {

          var marker = new google.maps.Marker({

              position: latLng,
              map: map

          }); 

          map.setCenter(marker.getPosition());
          
          /* if (map.getZoom() < 8) { map.setZoom(6); }
          else if (map.getZoom() == 6) { map.setZoom(8); }
          else if (map.getZoom() == 8) { map.setZoom(10); } 
          else {} */

          // Sets a limit for how far you can zoom in.
          if (map.getZoom() < 10) { map.setZoom(map.getZoom() + 2); }
          
          marker.setMap(null);

      }

      function zipZoom(latLng, map) {

          var center, zipcode;
          var marker = new google.maps.Marker({

              position: latLng,
              map: map

          }); 
          

          map.setCenter(marker.getPosition());
          center = map.getCenter();

          // Sets a limit for how far you can zoom in.
          map.setZoom(10);
          
          marker.setMap(null);

          // alert("Pre-Geocode");
          var geocoder = new google.maps.Geocoder();
          geocoder.geocode({'latLng': center}, function(results, status){
          
            // Ensure the status is good.
            if (status == google.maps.GeocoderStatus.OK) {

              // Iterate through the results array to find the zip code.
              var addressComponent = results[0].address_components;            
              for (var x = 0 ; x < addressComponent.length; x++) {

                  var chk = addressComponent[x];

                  if (chk.types[0] == 'postal_code') {

                      zipCode = chk.long_name;

                  }
              }

              if (zipCode) {
 
                 // Tested on the data layer. Working!
                 alert(zipCode);

              }

            }

          });

          


      }


      function resetMap(){

        var myLatlng = {lat: 38, lng: -95};

        main_map.setCenter(myLatlng);
        main_map.setZoom(4.9);

      }

      </script>
      <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlbhFBE6Pe-UpthT8KqrlXTIt91_9qgPc&callback=initMap">
      </script>
      <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

  
  </body>
</html>